function wookmarkFiller(e,t,n,r){t=typeof t!=="undefined"?t:false;n=typeof n!=="undefined"?n:false;var i=-1;var s=40;var o=page_wookmark;var u=wookmark_category;var a=-1;var f=r;if(!f){f=wookmark_channel}else{wookmark_channel=f}if(selectedUser){i=selectedUser}var l=jQuery("#searchText").val()||"";if(l==jQuery("#searchText").attr("placeholder")){l=""}var c=null;try{if(moment(selectedDate,"YYYY-MM-DD").isValid()){c=selectedDate+" 00:00:00"}}catch(h){}if(n)getLoader(true);jQuery.sessionphp.get("id",function(r){if(r)a=r;if(post_wookmark){return null}var h="";if(f==1){h="/index/events/upcoming?pageId="+o}else if(f==2){h="/index/events/mytimety?pageId="+o}else if(f==3){h="/index/events/following?pageId="+o}else if(f==4){h="/index/events/user?pageId="+o}else if(f==5){h="/index/events/created?pageId="+o}else if(f==6){h="/index/events/liked?pageId="+o}else if(f==7){h="/index/events/reshared?pageId="+o}else if(f==8){h="/index/events/joined?pageId="+o}else if(f==9){h="/index/events/category/"+u+"?pageId="+o}if(typeof something!="undefined")pSUPERFLY.virtualPage(h,h);post_wookmark=jQuery.ajax({type:"GET",url:TIMETY_PAGE_AJAX_GETEVENTS,dataType:"json",contentType:"application/json",data:{userId:a,pageNumber:o,pageItemCount:s,date:c,query:l,type:f,category:u,reqUserId:i,city_channel:city_channel},error:function(e,t,n){if(post_wookmark){post_wookmark.abort();post_wookmark=null}getLoader(false);showProfileBatch(f)},success:function(r){try{jQuery("#hiddenSearch").val("");var i=null;try{if(typeof r=="string"){i=jQuery.parseJSON(r)}else{i=r}}catch(s){console.log(s);console.log(r)}showProfileBatch(f);if(!i){if(n)getLoader(false);return}if(t){page_wookmark=0;localStorage.clear();jQuery(".main_event .main_event_box").not(jQuery(".profil_box")).remove()}jQuery.each(i,function(e,t){localStorage.setItem("event_"+t.id,JSON.stringify(t))});var o=[];jQuery.each(jQuery(".m_e_img"),function(e,t){try{var n=jQuery(t).find("img");if(n){var r=jQuery(n).attr("eventid");if(r)o.push(r)}}catch(t){console.log(t)}});i=jQuery.grep(i,function(e,t){return jQuery.inArray(e.id,o)<0});if(i.length>0){page_wookmark++}else{if(n)getLoader(false);return}wookmarkHTML(i,a);if(handler)handler.wookmarkClear();handler=jQuery(".main_event .main_event_box");handler.wookmark(e);if(n)getLoader(false);if(post_wookmark){post_wookmark.abort();post_wookmark=null}}catch(u){console.log(u);if(post_wookmark){post_wookmark.abort();post_wookmark=null}getLoader(false)}finally{if(post_wookmark){post_wookmark.abort();post_wookmark=null}getLoader(false)}}},"json")})}function wookmarkHTML(e,t){if(!e){e=[];for(i=0;i<localStorage.length;i++){var n=localStorage.key(i);if(!!n.match("^event_")){e.push(JSON.parse(localStorage[n]))}}}jQuery.each(e,function(e,n){if(!n.ad){var r=document.createElement("div");jQuery(r).addClass("main_event_box");jQuery(r).attr("date",n.endDateTime);var i=document.createElement("div");jQuery(i).addClass("m_e_img");var s=jQuery('<div style="overflow: hidden;"></div>');var o=document.createElement("img");jQuery(o).attr("eventid",n.id);jQuery(o).attr("onclick","return openModalPanel("+n.id+");");if(n.headerImage){var u="";if(n.headerImage.width&&n.headerImage.width!=0){jQuery(o).attr("width",n.headerImage.width);jQuery(s).css("width",n.headerImage.width+"px");u=u+"&w="+n.headerImage.width}else{jQuery(o).attr("width",186)}if(n.headerImage.height&&n.headerImage.height!=0){jQuery(o).attr("height",n.headerImage.height);jQuery(s).css("height",n.headerImage.height+"px");u=u+"&h="+n.headerImage.height}jQuery(o).attr("src",TIMETY_PAGE_GET_IMAGE_URL+TIMETY_SUBFOLDER+n.headerImage.url+u)}else{jQuery(o).attr("width",186);jQuery(o).attr("heigh",219)}jQuery(o).addClass("main_draggable");var a=document.createElement("div");jQuery(a).addClass("likeshare");jQuery(a).css("display","none");jQuery(a).attr("id","likeshare_"+n.id);var f=document.createElement("a");jQuery(f).addClass("timelineLikes");var l=document.createElement("a");jQuery(l).addClass("timelineButton");jQuery(l).attr("data-toggle","tooltip");jQuery(l).attr("data-placement","bottom");jQuery(l).attr("title","");jQuery(l).attr("class_aktif","like_btn_aktif");jQuery(l).attr("id","div_like_btn");jQuery(l).attr("class_pass","like_btn");if(t==n.creatorId){jQuery(f).css("display","none")}if(n.userRelation.like){jQuery(l).addClass("like_btn_aktif");jQuery(l).attr("pressed","true")}else{jQuery(l).addClass("like_btn");jQuery(l).attr("pressed","false")}jQuery(l).click(function(){likeEvent(this,n.id);return false});jQuery(f).append(l);var c=document.createElement("a");jQuery(c).addClass("timelineLikes");var h=document.createElement("a");jQuery(h).addClass("timelineButton");jQuery(h).attr("data-toggle","tooltip");jQuery(h).attr("data-placement","bottom");jQuery(h).attr("title","");jQuery(h).attr("class_aktif","maybe_btn_aktif");jQuery(h).attr("id","div_maybe_btn");jQuery(h).attr("class_pass","maybe_btn");if(t==n.creatorId){jQuery(h).css("display","none")}if(t==n.creatorId){jQuery(c).css("display","none")}if(n.userRelation.joinType==2){jQuery(h).addClass("maybe_btn_aktif");jQuery(h).attr("pressed","true")}else{jQuery(h).addClass("maybe_btn");jQuery(h).attr("pressed","false")}jQuery(h).click(function(){sendResponseEvent(this,n.id,2);return false});jQuery(c).append(h);var p=document.createElement("a");jQuery(p).addClass("timelineLikes");var d=document.createElement("a");jQuery(d).addClass("timelineButton");jQuery(d).attr("data-toggle","tooltip");jQuery(d).attr("data-placement","bottom");jQuery(d).attr("title","");jQuery(d).attr("class_aktif","share_btn_aktif");jQuery(d).attr("id","div_share_btn");jQuery(d).attr("class_pass","share_btn");if(t==n.creatorId){jQuery(p).css("display","none")}if(n.userRelation.reshare){jQuery(d).addClass("share_btn_aktif");jQuery(d).attr("pressed","true")}else{jQuery(d).addClass("share_btn");jQuery(d).attr("pressed","false")}jQuery(d).click(function(){reshareEvent(this,n.id);return false});jQuery(p).append(d);var v=document.createElement("a");jQuery(v).addClass("timelineLikes");var m=document.createElement("a");jQuery(m).addClass("timelineButton");jQuery(m).attr("data-toggle","tooltip");jQuery(m).attr("data-placement","bottom");jQuery(m).attr("title","");jQuery(m).attr("class_aktif","join_btn_aktif");jQuery(m).attr("id","div_join_btn");jQuery(m).attr("class_pass","join_btn");if(t==n.creatorId){jQuery(v).css("display","none")}if(n.userRelation.joinType==1){jQuery(m).addClass("join_btn_aktif");jQuery(m).attr("pressed","true")}else{jQuery(m).addClass("join_btn");jQuery(m).attr("pressed","false")}jQuery(m).click(function(){sendResponseEvent(this,n.id,1);return false});jQuery(v).append(m);var g=document.createElement("a");jQuery(g).addClass("timelineLikes");var y=document.createElement("a");jQuery(y).addClass("timelineButton");jQuery(y).attr("data-toggle","tooltip");jQuery(y).attr("data-placement","bottom");jQuery(y).attr("title","");jQuery(y).attr("class_aktif","edit_btn_aktif");jQuery(y).attr("id","div_edit_btn");jQuery(y).attr("class_pass","edit_btn");if(t!=n.creatorId){jQuery(g).css("display","none")}jQuery(y).addClass("edit_btn");jQuery(y).click(function(){openEditEvent(n.id);return false});jQuery(g).append(y);jQuery(a).append(f);jQuery(a).append(p);jQuery(a).append(c);jQuery(a).append(v);jQuery(a).append(g);jQuery(i).append(a);jQuery(i).attr("id","div_img_event_"+n.id);jQuery(s).append(o);jQuery(i).append(s);jQuery(r).append(i);var b=document.createElement("div");jQuery(b).addClass("m_e_metin");var w=document.createElement("div");jQuery(w).addClass("m_e_baslik");jQuery(w).append(n.title);jQuery(b).append(w);var E=document.createElement("div");jQuery(E).addClass("m_e_com");var S=document.createElement("p");jQuery(S).css("cursor","pointer");jQuery(E).append(S);jQuery(b).append(E);var x=true;if((wookmark_channel==4||wookmark_channel==10||wookmark_channel==11||wookmark_channel==12||wookmark_channel==13)&&reqUserPic&&reqUserUserName&&reqUserFullName&&selectedUser){x=false}if(x){if(n.creator){jQuery(S).attr("onclick","window.location='"+TIMETY_HOSTNAME+n.creator.userName+"';");var T=n.creator.userPicture;if(T==null||T==""){T=TIMETY_HOSTNAME+"images/anonymous.png"}if(T.indexOf("http")!=0){T=TIMETY_HOSTNAME+T}jQuery(S).append(jQuery('<img src="'+T+'" width="22" height="22" align="absmiddle"></img>'));var N="";if(n.creator.firstName){N=n.creator.firstName+" "}if(n.creator.lastName){N=N+n.creator.lastName+" "}jQuery(S).append(jQuery("<span>"+" "+N+"</span>"))}}else{jQuery(S).attr("onclick","window.location='"+TIMETY_HOSTNAME+reqUserUserName+"';");var T=reqUserPic;if(T==null||T==""){T=TIMETY_HOSTNAME+"images/anonymous.png"}if(T.indexOf("http")!=0){T=TIMETY_HOSTNAME+T}jQuery(S).append(jQuery('<img src="'+T+'" width="22" height="22" align="absmiddle"></img>'));jQuery(S).append(jQuery("<span>"+" "+reqUserFullName+"</span>"));jQuery(S).append(jQuery("<span>"+" "+getUserLastActivityString(n,selectedUser)+"</span>"))}var C=document.createElement("div");jQuery(C).addClass("m_e_ackl");jQuery(C).append(n.description);jQuery(b).append(C);var k=document.createElement("div");jQuery(k).addClass("m_e_drm");var L=document.createElement("ul");var A=document.createElement("li");var O=document.createElement("a");var M=document.createElement("img");jQuery(M).attr("src",TIMETY_HOSTNAME+"images/usr.png");jQuery(M).attr("width",18);jQuery(M).attr("heigh",18);jQuery(M).attr("align","absmiddle");jQuery(M).attr("border",0);jQuery(O).attr("href","#");jQuery(O).attr("onclick","return false;");jQuery(O).addClass("mavi_link");jQuery(A).addClass("m_e_cizgi");jQuery(O).append(M);jQuery(O).append(n.attendancecount);jQuery(A).append(O);jQuery(L).append(A);var _=document.createElement("li");var D=document.createElement("a");var P=document.createElement("img");jQuery(P).attr("src",TIMETY_HOSTNAME+"images/comm.png");jQuery(P).attr("width",18);jQuery(P).attr("heigh",18);jQuery(P).attr("align","absmiddle");jQuery(P).attr("border",0);jQuery(D).attr("href","#");jQuery(D).attr("onclick","return false;");jQuery(D).addClass("turuncu_link");jQuery(_).addClass("m_e_cizgi");jQuery(D).append(P);jQuery(D).append(n.commentCount);jQuery(_).append(D);jQuery(L).append(_);var H=calculateRemainingTime(n.startDateTime);var B=document.createElement("li");var j=document.createElement("a");var F=document.createElement("img");if(H=="Past"){jQuery(F).attr("src",TIMETY_HOSTNAME+"images/zmn_k.png")}else{jQuery(F).attr("src",TIMETY_HOSTNAME+"images/zmn.png")}jQuery(F).attr("width",18);jQuery(F).attr("heigh",18);jQuery(F).attr("align","absmiddle");jQuery(F).attr("border",0);jQuery(j).attr("href","#");jQuery(j).attr("onclick","return false;");if(H=="Past"){jQuery(j).addClass("turuncu_link")}else{jQuery(j).addClass("yesil_link")}jQuery(j).append(F);jQuery(j).append(calculateRemainingTime(n.startDateTime));jQuery(B).append(j);jQuery(L).append(B);if(!!n.location){var I=document.createElement("div");jQuery(I).addClass("m_e_alt");jQuery(I).append(n.location)}jQuery(k).append(L);jQuery(b).append(k);jQuery(r).append(b);jQuery(".main_event").append(r);likeshareInit(t,a)}else{r=document.createElement("div");jQuery(r).addClass("main_event_box");i=document.createElement("div");jQuery(i).addClass("m_e_img");o=document.createElement("img");jQuery(o).attr("onclick",'window.open("'+n.url+'","_blank");return false;');if(n.img){jQuery(o).attr("src",TIMETY_HOSTNAME+n.img);if(n.imgWidth&&n.imgWidth!=0)jQuery(o).attr("width",n.imgWidth);else jQuery(o).attr("width",186);if(n.imgHeight&&n.imgHeight!=0)jQuery(o).attr("height",n.imgHeight)}else{jQuery(o).attr("width",186);jQuery(o).attr("heigh",275)}jQuery(i).append(o);jQuery(r).append(i);b=document.createElement("div");jQuery(b).addClass("m_e_metin");k=document.createElement("div");jQuery(k).addClass("m_e_drm");L=document.createElement("ul");A=document.createElement("li");O=document.createElement("a");M=document.createElement("img");jQuery(M).attr("src",TIMETY_HOSTNAME+"images/usr.png");jQuery(M).attr("width",18);jQuery(M).attr("heigh",18);jQuery(M).attr("align","absmiddle");jQuery(M).attr("border",0);jQuery(O).attr("href","#");jQuery(O).addClass("mavi_link");jQuery(A).addClass("m_e_cizgi");jQuery(O).append(M);jQuery(O).append(n.people);jQuery(A).append(O);jQuery(L).append(A);_=document.createElement("li");D=document.createElement("a");P=document.createElement("img");jQuery(P).attr("src",TIMETY_HOSTNAME+"images/comm.png");jQuery(P).attr("width",18);jQuery(P).attr("heigh",18);jQuery(P).attr("align","absmiddle");jQuery(P).attr("border",0);jQuery(D).attr("href","#");jQuery(D).addClass("turuncu_link");jQuery(_).addClass("m_e_cizgi");jQuery(D).append(P);jQuery(D).append(n.comment);jQuery(_).append(D);jQuery(L).append(_);B=document.createElement("li");j=document.createElement("a");F=document.createElement("img");jQuery(F).attr("src",TIMETY_HOSTNAME+"images/zmn.png");jQuery(F).attr("width",18);jQuery(F).attr("heigh",18);jQuery(F).attr("align","absmiddle");jQuery(F).attr("border",0);jQuery(j).attr("href","#");jQuery(j).addClass("yesil_link");jQuery(j).append(F);jQuery(j).append(n.time);jQuery(B).append(j);jQuery(L).append(B);jQuery(k).append(L);jQuery(b).append(k);jQuery(r).append(b);jQuery(".main_event").append(r)}})}function showProfileBatch(e){var t=null;var n=null;if(e==2||e=="2"||e==5||e=="5"||e==6||e=="6"||e==7||e=="7"||e==8||e=="8"||e==4||e=="4"||e==10||e=="10"||e==11||e=="11"||e==12||e=="12"||e==13||e=="13"){t=jQuery("#dump .profil_box");if(t){t.prependTo(".main_event")}}else{t=jQuery(".main_event .profil_box");if(t){t.prependTo("#dump")}}}function getUserLastActivityString(e,t){var n="updated";var r="created";var i="join";var s="maybe";var o="like";var u="reshare";var a="follow";var f="update";var l="comment";if(e&&t){if(e.userEventLog&&e.userEventLog.length>0){var c="";var h=e.userEventLog[0];if(h){c=h.action;if(c==r){return"created this"}}for(var p=e.userEventLog.length-1;p>=0;p--){h=e.userEventLog[p];if(h){if(h.userId==t){c=h.action;break}}}if(c==n||c==r||c==f||c==l){return"created this"}else if(c==i||c==s){return"joined this"}else if(c==o){return"liked this"}else if(c==u){return"reshared this"}else if(c==a){return"followed this"}return c}}return""}function calculateRemainingTime(e){if(e){var t=moment(e,"YYYY.MM.DD HH:mm");if(t.isBefore(moment())){return"Past"}else{var n=t.diff(moment(),"years");if(n>0){return n+"y"}var r=t.diff(moment(),"months");if(r>0){return r+"mo"}var i=t.diff(moment(),"days");if(i>0){return i+"d"}var s=t.diff(moment(),"minutes");if(s>0){return s+"m"}return"Now"}}}var post_wookmark=null;var page_wookmark=1;var city_channel=-1;var wookmark_channel=1;var wookmark_category=-1;localStorage.clear();var selectedDate=null;var selectedUser=null
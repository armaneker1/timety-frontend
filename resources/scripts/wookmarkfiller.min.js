function wookmarkFiller(e,t,n,r){t=typeof t!=="undefined"?t:false;n=typeof n!=="undefined"?n:false;var i=-1;var s=40;var o=page_wookmark;var u=wookmark_category;var a=-1;var f=r;if(!f){f=wookmark_channel}else{wookmark_channel=f}if(selectedUser){i=selectedUser}var l=jQuery("#searchText").val()||"";if(l==jQuery("#searchText").attr("placeholder")){l=""}var c=null;try{if(moment(selectedDate,"YYYY-MM-DD").isValid()){c=selectedDate+" 00:00:00"}}catch(h){}if(n)getLoader(true);jQuery.sessionphp.get("id",function(r){if(r)a=r;if(post_wookmark){return null}var h="";if(f==1){h="/index/events/upcoming?pageId="+o}else if(f==2){h="/index/events/mytimety?pageId="+o}else if(f==3){h="/index/events/following?pageId="+o}else if(f==4){h="/index/events/user?pageId="+o}else if(f==5){h="/index/events/created?pageId="+o}else if(f==6){h="/index/events/liked?pageId="+o}else if(f==7){h="/index/events/reshared?pageId="+o}else if(f==8){h="/index/events/joined?pageId="+o}else if(f==9){h="/index/events/category/"+u+"?pageId="+o}if(typeof pSUPERFLY!="undefined")pSUPERFLY.virtualPage(h,h);var p=null;try{p=JSON.stringify(tagIds)}catch(d){console.log(d)}post_wookmark=jQuery.ajax({type:"GET",url:TIMETY_PAGE_AJAX_GETEVENTS,dataType:"json",contentType:"application/json",data:{userId:a,pageNumber:o,pageItemCount:s,date:c,query:l,type:f,category:u,reqUserId:i,city_channel:city_channel,tagIds:p},error:function(e,t,n){if(post_wookmark){post_wookmark.abort();post_wookmark=null}getLoader(false);if(isearching)getInfo(true,"No result found","info",3e3);isearching=false;showProfileBatch(f)},success:function(r){try{jQuery("#hiddenSearch").val("");var i=null;try{if(typeof r=="string"){i=jQuery.parseJSON(r)}else{i=r}}catch(s){console.log(s);console.log(r)}showProfileBatch(f);if(!i){if(n)getLoader(false);return}if(t){page_wookmark=0;localStorage.clear();jQuery(".main_event .main_event_box").not(jQuery(".profil_box")).remove()}jQuery.each(i,function(e,t){localStorage.setItem("event_"+t.id,JSON.stringify(t))});var o=[];jQuery.each(jQuery(".m_e_img"),function(e,t){try{var n=jQuery(t).find("img");if(n){var r=jQuery(n).attr("eventid");if(r)o.push(r)}}catch(t){console.log(t)}});i=jQuery.grep(i,function(e,t){return jQuery.inArray(e.id,o)<0});if(i.length>0){page_wookmark++}else{if(n)getLoader(false);if(isearching)getInfo(true,"No result found","info",3e3);isearching=false;return}wookmarkHTML(i,a);if(handler)handler.wookmarkClear();handler=jQuery(".main_event .main_event_box");handler.wookmark(e);if(n)getLoader(false);if(post_wookmark){post_wookmark.abort();post_wookmark=null}}catch(u){console.log(u);if(post_wookmark){post_wookmark.abort();post_wookmark=null}getLoader(false)}finally{if(post_wookmark){post_wookmark.abort();post_wookmark=null}getLoader(false)}}},"json")})}function wookmarkHTML(e,t){if(!e){e=[];for(i=0;i<localStorage.length;i++){var n=localStorage.key(i);if(!!n.match("^event_")){e.push(JSON.parse(localStorage[n]))}}}jQuery.each(e,function(e,n){if(!n.ad){var r=document.createElement("div");jQuery(r).addClass("main_event_box");jQuery(r).attr("date",n.endDateTime);var i=document.createElement("div");jQuery(i).addClass("m_e_img");var s=jQuery('<div style="overflow: hidden;"></div>');var o=document.createElement("img");jQuery(o).attr("eventid",n.id);jQuery(o).attr("onclick","return openModalPanel("+n.id+");");if(n.headerImage){var u="";if(n.headerImage.width&&n.headerImage.width!=0){jQuery(o).attr("width",n.headerImage.width);jQuery(s).css("width",n.headerImage.width+"px");u=u+"&w="+n.headerImage.width}else{jQuery(o).attr("width",186)}if(n.headerImage.height&&n.headerImage.height!=0){jQuery(o).attr("height",n.headerImage.height);var a=0;if(n.headerImage.height<125){a=(125-n.headerImage.height)/2}jQuery(s).css("margin-bottom",a+"px");jQuery(s).css("margin-top",a+"px");jQuery(s).css("height",n.headerImage.height+"px");u=u+"&h="+n.headerImage.height}jQuery(o).attr("src",TIMETY_PAGE_GET_IMAGE_URL+TIMETY_SUBFOLDER+n.headerImage.url+u)}else{jQuery(o).attr("width",186);jQuery(o).attr("heigh",219)}jQuery(o).addClass("main_draggable");var f=document.createElement("div");jQuery(f).addClass("likeshare");jQuery(f).css("display","none");jQuery(f).attr("id","likeshare_"+n.id);var l=document.createElement("a");jQuery(l).addClass("timelineLikes");var c=document.createElement("a");jQuery(c).addClass("timelineButton");jQuery(c).attr("data-toggle","tooltip");jQuery(c).attr("data-placement","bottom");jQuery(c).attr("title","");jQuery(c).attr("class_aktif","like_btn_aktif");jQuery(c).attr("id","div_like_btn");jQuery(c).attr("class_pass","like_btn");if(t==n.creatorId){jQuery(l).css("display","none")}if(n.userRelation.like){jQuery(c).addClass("like_btn_aktif");jQuery(c).attr("pressed","true")}else{jQuery(c).addClass("like_btn");jQuery(c).attr("pressed","false")}jQuery(c).click(function(){likeEvent(this,n.id);return false});jQuery(l).append(c);var h=document.createElement("a");jQuery(h).addClass("timelineLikes");var p=document.createElement("a");jQuery(p).addClass("timelineButton");jQuery(p).attr("data-toggle","tooltip");jQuery(p).attr("data-placement","bottom");jQuery(p).attr("title","");jQuery(p).attr("class_aktif","maybe_btn_aktif");jQuery(p).attr("id","div_maybe_btn");jQuery(p).attr("class_pass","maybe_btn");if(t==n.creatorId){jQuery(p).css("display","none")}if(t==n.creatorId){jQuery(h).css("display","none")}if(n.userRelation.joinType==2){jQuery(p).addClass("maybe_btn_aktif");jQuery(p).attr("pressed","true")}else{jQuery(p).addClass("maybe_btn");jQuery(p).attr("pressed","false")}jQuery(p).click(function(){sendResponseEvent(this,n.id,2);return false});jQuery(h).append(p);var d=document.createElement("a");jQuery(d).addClass("timelineLikes");var v=document.createElement("a");jQuery(v).addClass("timelineButton");jQuery(v).attr("data-toggle","tooltip");jQuery(v).attr("data-placement","bottom");jQuery(v).attr("title","");jQuery(v).attr("class_aktif","share_btn_aktif");jQuery(v).attr("id","div_share_btn");jQuery(v).attr("class_pass","share_btn");if(t==n.creatorId){jQuery(d).css("display","none")}if(n.userRelation.reshare){jQuery(v).addClass("share_btn_aktif");jQuery(v).attr("pressed","true")}else{jQuery(v).addClass("share_btn");jQuery(v).attr("pressed","false")}jQuery(v).click(function(){reshareEvent(this,n.id);return false});jQuery(d).append(v);var m=document.createElement("a");jQuery(m).addClass("timelineLikes");var g=document.createElement("a");jQuery(g).addClass("timelineButton");jQuery(g).attr("data-toggle","tooltip");jQuery(g).attr("data-placement","bottom");jQuery(g).attr("title","");jQuery(g).attr("class_aktif","join_btn_aktif");jQuery(g).attr("id","div_join_btn");jQuery(g).attr("class_pass","join_btn");if(t==n.creatorId){jQuery(m).css("display","none")}if(n.userRelation.joinType==1){jQuery(g).addClass("join_btn_aktif");jQuery(g).attr("pressed","true")}else{jQuery(g).addClass("join_btn");jQuery(g).attr("pressed","false")}jQuery(g).click(function(){sendResponseEvent(this,n.id,1);return false});jQuery(m).append(g);var y=document.createElement("a");jQuery(y).addClass("timelineLikes");var b=document.createElement("a");jQuery(b).addClass("timelineButton");jQuery(b).attr("data-toggle","tooltip");jQuery(b).attr("data-placement","bottom");jQuery(b).attr("title","");jQuery(b).attr("class_aktif","edit_btn_aktif");jQuery(b).attr("id","div_edit_btn");jQuery(b).attr("class_pass","edit_btn");if(t!=n.creatorId){jQuery(y).css("display","none")}jQuery(b).addClass("edit_btn");jQuery(b).click(function(){openEditEvent(n.id);return false});jQuery(y).append(b);jQuery(f).append(l);jQuery(f).append(d);jQuery(f).append(h);jQuery(f).append(m);jQuery(f).append(y);if(t){jQuery(i).append(f)}jQuery(i).attr("id","div_img_event_"+n.id);jQuery(s).append(o);jQuery(i).append(s);jQuery(r).append(i);var w=document.createElement("div");jQuery(w).addClass("m_e_metin");var E=document.createElement("div");jQuery(E).addClass("m_e_baslik");jQuery(E).append(n.title);jQuery(w).append(E);var S=document.createElement("div");jQuery(S).addClass("m_e_com");var x=document.createElement("p");jQuery(x).css("cursor","pointer");jQuery(S).append(x);jQuery(w).append(S);var T=true;if((wookmark_channel==4||wookmark_channel==10||wookmark_channel==11||wookmark_channel==12||wookmark_channel==13)&&reqUserPic&&reqUserUserName&&reqUserFullName&&selectedUser){T=false}if(T){if(n.creator){jQuery(x).attr("onclick","window.location='"+TIMETY_HOSTNAME+n.creator.userName+"';");var N=n.creator.userPicture;if(N==null||N==""){N=TIMETY_HOSTNAME+"images/anonymous.png"}if(N.indexOf("http")!=0){N=TIMETY_HOSTNAME+N}jQuery(x).append(jQuery('<img src="'+N+'" width="22" height="22" align="absmiddle"></img>'));var C="";if(n.creator.firstName){C=n.creator.firstName+" "}if(n.creator.lastName){C=C+n.creator.lastName+" "}jQuery(x).append(jQuery("<span>"+" "+C+"</span>"))}}else{jQuery(x).attr("onclick","window.location='"+TIMETY_HOSTNAME+reqUserUserName+"';");var N=reqUserPic;if(N==null||N==""){N=TIMETY_HOSTNAME+"images/anonymous.png"}if(N.indexOf("http")!=0){N=TIMETY_HOSTNAME+N}jQuery(x).append(jQuery('<img src="'+N+'" width="22" height="22" align="absmiddle"></img>'));jQuery(x).append(jQuery("<span>"+" "+reqUserFullName+"</span>"));jQuery(x).append(jQuery("<span>"+" "+getUserLastActivityString(n,selectedUser)+"</span>"))}var k=document.createElement("div");jQuery(k).addClass("m_e_ackl");jQuery(k).append(n.description);jQuery(w).append(k);var L=document.createElement("div");jQuery(L).addClass("m_e_drm");var A=document.createElement("ul");var O=document.createElement("li");var M=document.createElement("a");var _=document.createElement("img");jQuery(_).attr("src",TIMETY_HOSTNAME+"images/usr.png");jQuery(_).attr("width",18);jQuery(_).attr("heigh",18);jQuery(_).attr("align","absmiddle");jQuery(_).attr("border",0);jQuery(M).attr("href","#");jQuery(M).attr("onclick","return false;");jQuery(M).addClass("mavi_link");jQuery(O).addClass("m_e_cizgi");jQuery(M).append(_);jQuery(M).append(n.attendancecount);jQuery(O).append(M);jQuery(A).append(O);var D=document.createElement("li");var P=document.createElement("a");var H=document.createElement("img");jQuery(H).attr("src",TIMETY_HOSTNAME+"images/comm.png");jQuery(H).attr("width",18);jQuery(H).attr("heigh",18);jQuery(H).attr("align","absmiddle");jQuery(H).attr("border",0);jQuery(P).attr("href","#");jQuery(P).attr("onclick","return false;");jQuery(P).addClass("turuncu_link");jQuery(D).addClass("m_e_cizgi");jQuery(P).append(H);jQuery(P).append(n.commentCount);jQuery(D).append(P);jQuery(A).append(D);var B=calculateRemainingTime(n.startDateTime);var j=document.createElement("li");var F=document.createElement("a");var I=document.createElement("img");if(B=="Past"){jQuery(I).attr("src",TIMETY_HOSTNAME+"images/zmn_k.png")}else{jQuery(I).attr("src",TIMETY_HOSTNAME+"images/zmn.png")}jQuery(I).attr("width",18);jQuery(I).attr("heigh",18);jQuery(I).attr("align","absmiddle");jQuery(I).attr("border",0);jQuery(F).attr("href","#");jQuery(F).attr("onclick","return false;");if(B=="Past"){jQuery(F).addClass("turuncu_link")}else{jQuery(F).addClass("yesil_link")}jQuery(F).append(I);jQuery(F).append(calculateRemainingTime(n.startDateTime));jQuery(j).append(F);jQuery(A).append(j);if(!!n.location){var q=document.createElement("div");jQuery(q).addClass("m_e_alt");jQuery(q).append(n.location)}jQuery(L).append(A);jQuery(w).append(L);jQuery(r).append(w);jQuery(".main_event").append(r);likeshareInit(t,f)}else{r=document.createElement("div");jQuery(r).addClass("main_event_box");i=document.createElement("div");jQuery(i).addClass("m_e_img");o=document.createElement("img");jQuery(o).attr("onclick",'window.open("'+n.url+'","_blank");return false;');if(n.img){jQuery(o).attr("src",TIMETY_HOSTNAME+n.img);if(n.imgWidth&&n.imgWidth!=0)jQuery(o).attr("width",n.imgWidth);else jQuery(o).attr("width",186);if(n.imgHeight&&n.imgHeight!=0)jQuery(o).attr("height",n.imgHeight)}else{jQuery(o).attr("width",186);jQuery(o).attr("heigh",275)}jQuery(i).append(o);jQuery(r).append(i);w=document.createElement("div");jQuery(w).addClass("m_e_metin");L=document.createElement("div");jQuery(L).addClass("m_e_drm");A=document.createElement("ul");O=document.createElement("li");M=document.createElement("a");_=document.createElement("img");jQuery(_).attr("src",TIMETY_HOSTNAME+"images/usr.png");jQuery(_).attr("width",18);jQuery(_).attr("heigh",18);jQuery(_).attr("align","absmiddle");jQuery(_).attr("border",0);jQuery(M).attr("href","#");jQuery(M).addClass("mavi_link");jQuery(O).addClass("m_e_cizgi");jQuery(M).append(_);jQuery(M).append(n.people);jQuery(O).append(M);jQuery(A).append(O);D=document.createElement("li");P=document.createElement("a");H=document.createElement("img");jQuery(H).attr("src",TIMETY_HOSTNAME+"images/comm.png");jQuery(H).attr("width",18);jQuery(H).attr("heigh",18);jQuery(H).attr("align","absmiddle");jQuery(H).attr("border",0);jQuery(P).attr("href","#");jQuery(P).addClass("turuncu_link");jQuery(D).addClass("m_e_cizgi");jQuery(P).append(H);jQuery(P).append(n.comment);jQuery(D).append(P);jQuery(A).append(D);j=document.createElement("li");F=document.createElement("a");I=document.createElement("img");jQuery(I).attr("src",TIMETY_HOSTNAME+"images/zmn.png");jQuery(I).attr("width",18);jQuery(I).attr("heigh",18);jQuery(I).attr("align","absmiddle");jQuery(I).attr("border",0);jQuery(F).attr("href","#");jQuery(F).addClass("yesil_link");jQuery(F).append(I);jQuery(F).append(n.time);jQuery(j).append(F);jQuery(A).append(j);jQuery(L).append(A);jQuery(w).append(L);jQuery(r).append(w);jQuery(".main_event").append(r)}})}function showProfileBatch(e){var t=null;var n=null;if(e==2||e=="2"||e==5||e=="5"||e==6||e=="6"||e==7||e=="7"||e==8||e=="8"||e==4||e=="4"||e==10||e=="10"||e==11||e=="11"||e==12||e=="12"||e==13||e=="13"){t=jQuery("#dump .profil_box");if(t){t.prependTo(".main_event")}}else{t=jQuery(".main_event .profil_box");if(t){t.prependTo("#dump")}}}function getUserLastActivityString(e,t){var n="updated";var r="created";var i="join";var s="maybe";var o="like";var u="reshare";var a="follow";var f="update";var l="comment";if(e&&t){if(e.userEventLog&&e.userEventLog.length>0){var c="";var h=e.userEventLog[0];if(h){c=h.action;if(c==r){return"created this"}}for(var p=e.userEventLog.length-1;p>=0;p--){h=e.userEventLog[p];if(h){if(h.userId==t){c=h.action;break}}}if(c==n||c==r||c==f||c==l){return"created this"}else if(c==i||c==s){return"joined this"}else if(c==o){return"liked this"}else if(c==u){return"reshared this"}else if(c==a){return"followed this"}return c}}return""}function calculateRemainingTime(e){if(e){var t=moment(getLocalTime(e).format("YYYY.MM.DD HH:mm"),"YYYY.MM.DD HH:mm");var n=moment().utc();if(t.isBefore(n)){return"Past"}else{var r=t.diff(n,"years");if(r>0){return r+" years"}var i=t.diff(n,"months");if(i>0){if(i==1){return"Next month"}else{return i+" months"}}var s=t.diff(n,"days");if(s>0){if(s==1){return"Tomorrow"}else{var o=parseInt(n.format("d"));o=o+s;if(o<=7){return t.format("dddd")}else if(o>7&&o<=14){return"Next week"}else{var u=parseInt(n.format("M"));var a=parseInt(t.format("M"));if(a==u){if(o>14&&o<=21){return"2 weeks"}else if(o>21&&o<=28){return"3 weeks"}else{return"4 weeks"}}else{return"Next month"}}}}var f=t.diff(n,"hours");if(f>0){var l=parseInt(n.format("D"));var c=parseInt(t.format("D"));if(l==c){return f+" hours"}else{return"Tomorrow"}}var h=t.diff(n,"minutes");if(h>0){return h+" minutes"}return"Now"}}}var post_wookmark=null;var page_wookmark=1;var city_channel=-1;var wookmark_channel=1;var wookmark_category=-1;localStorage.clear();var selectedDate=null;var selectedUser=null;var isearching=false;var tagIds=null
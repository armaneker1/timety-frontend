function getMediaDataFromLocalStorage(e){return JSON.parse(localStorage.getItem("media_"+e))}function getMediaDetailFromServer(e){jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETEVENT,data:{eventId:e},success:function(e){var t=null;try{if(typeof e=="string"){t=jQuery.parseJSON(e)}else{t=e}}catch(n){console.log(n);console.log(e)}if(t&&t.id){localStorage.setItem("event_"+t.id,e);openModalPanel(t.id,null)}else{closeMedialPanel()}}},"json")}function openMediaModalPanel(e,t){jQuery("#genel_detay_yeni").hide();var n=jQuery("#media_big_image_header");n.show();var r=jQuery("#meida_video_player");r.hide();var i=null;if(!t){i=getMediaDataFromLocalStorage(e);if(!i){getMediaDetailFromServer(e);return false}if(!addUrlMediaId(i)){closeMedialPanel();return false}}else{i=JSON.parse(t);if(!i){getEventDetailFromServer(event_id);return false}}showBackGround();var s=jQuery("#media_panel");if(s){document.current_media_id=e;jQuery(s).unbind("click");jQuery(s).on("click",function(e){e.stopPropagation();e.preventDefault();return false});if(i.description){document.title=i.description;jQuery("#media_description").text(i.description)}else{jQuery("#media_description").text("")}jQuery("#media_name_creator").text("");if(i.userName){jQuery("#media_name_creator").text(i.userName)}jQuery("#media_image_creator").unbind("click");var o=TIMETY_HOSTNAME+"images/anonymous.png";if(i.type){if(i.type=="twitter"){o=TIMETY_HOSTNAME+"images/tw_logo.png"}else if(i.type=="vine"){o=TIMETY_HOSTNAME+"images/vine_logo.png"}else if(i.type=="instagram"){o=TIMETY_HOSTNAME+"images/ins_logo.png"}}setImageBackGroundCenter(jQuery("#media_image_creator"),48,48,0,0,o);var u=true;if(i.meidaType&&i.meidaType==1&&i.videoUrl&&i.videoUrl!=""){if(i.type&&i.type=="vine"&&i.socialUrl){jQuery("#media_big_image_header").hide();var a=jQuery('<iframe src="'+i.socialUrl+'/card" width="561" height="561" title="Embedded media player"></iframe>');jQuery("#meida_video_player").children().remove();jQuery("#meida_video_player").append(a);jQuery("#meida_video_player").show();u=false}}if(u){var f=true;try{var l=jQuery("img[mediaid='"+e+"']");if(l&&l.length>0){var c=i.imgWidth;var h=i.imgHeight;if(c>0&&h>0){if(c>561){h=561/c*h;c=561}jQuery(n).attr("height",h);jQuery(n).attr("width",c);jQuery(n).attr("src",l.attr("src"));f=false}}}catch(p){console.log(p)}if(f){try{jQuery(n).attr("src",i.imgUrl)}catch(p){console.log(p)}}var d=new Object;d.url=i.imgUrl;d.org_width=i.imgWidth;d.org_height=i.imgHeight;setMediaHeaderImage(n,d,e);jQuery(n).attr("style","position:relative;margin-left:auto;margin-right:auto;");jQuery(n).css("min-height","30px");jQuery(n).css("min-width","30px");jQuery(n).css("margin-bottom","3px");jQuery(n).css("cursor","pointer");jQuery(n).unbind("click");if(i.socialUrl){jQuery(n).data("socialUrl",i.socialUrl);jQuery(n).click(function(){var e=jQuery(n).data("socialUrl");if(e){if(e.indexOf("http")!=0){e="http://"+e}window.open(e,"_blank")}})}}jQuery("#media_fb_share_button").unbind("click");jQuery("#media_tw_share_button").unbind("click");jQuery("#media_gg_share_button").unbind("click");jQuery("#media_fb_share_button").click(shareThisFacebook);jQuery("#media_tw_share_button").click(function(){var e="";if(i.description){e=i.description}shareThisTwitter(e)});jQuery("#media_gg_share_button").click(shareThisGoogle);jQuery(s).fadeIn(400);navigateMedia(e)}else{closeMedialPanel()}}function closeMedialPanel(){stopNavigateMedia();try{jQuery("#meida_video_player").children().remove()}catch(e){console.log(e)}try{remUrlMediaId();document.title=getLanguageText("LANG_PAGE_TITLE");var t=document.getElementById("div_follow_trans");jQuery(t).unbind("click");jQuery(t).bind("click",function(){return false});jQuery(t).fadeOut(500,function(){document.body.style.overflowY="scroll"});jQuery("#media_panel").fadeOut(450)}catch(n){console.log(n)}return false}function setMediaHeaderImage(e,t,n){if(e&&t&&t.url){var r=new Image;var i=t.org_width;var s=t.org_height;if(i>0&&s>0){if(i>561){s=561/i*s;i=561}}var o=TIMETY_SUBFOLDER+t.url;if(t.url.indexOf("http")==0||t.url.indexOf("www")==0){o=encodeURIComponent(t.url)}var u=TIMETY_PAGE_GET_IMAGE_URL+""+o+"&w="+i+"&h="+s;r.src=u;r.onload=function(){curr=document.current_media_id;if(curr==n){var i=false;var s="";var o=0;var a=0;o=r.width;a=r.height;if(o<1&&a<1){o=t.width;a=t.height}if(o>0&&a>0){if(o>561){a=561/o*a;o=561}jQuery(e).attr("src",u);i=true;setTimeout(function(){jQuery(e).attr("height",a);jQuery(e).attr("width",o)},10)}else{jQuery(e).css("max-width","560px")}if(!i){jQuery(e).attr("src",TIMETY_HOSTNAME+t.url)}}}}}function addUrlMediaId(e){if(popup_userName){var t=null;if(e&&e.type&&e.socialID){t=e.type+"_"+e.socialID}if(t){if(history.pushState){window.History.pushState(null,null,"/"+popup_userName+"/media/"+t);_gaq.push(["_setAccount",TIMETY_GOOGLE_ANALYTICS]);_gaq.push(["_trackPageview",location.pathname+location.search+location.hash])}else{getLoader(true);window.location=TIMETY_HOSTNAME+popup_userName+"/media/"+t;return false}}}return true}function remUrlMediaId(){if(history.pushState){if(oldUrl){window.History.pushState(null,null,oldUrl)}else{var e=window.location.href.split("/");if(e){if(jQuery.inArray("event",e)>=0){var t="";for(var n=jQuery.inArray(window.location.hostname,e)+1;n<e.length&&e[n]!="event";n++){t=t+"/"+e[n]}if(popup_userName){window.History.pushState(null,null,t+"/"+popup_userName+"/media")}else{window.History.pushState(null,null,t+"/")}}else if(jQuery.inArray("media",e)>=0){var t="";for(n=jQuery.inArray(window.location.hostname,e)+1;n<e.length&&e[n]!="media";n++){t=t+"/"+e[n]}if(popup_userName){window.History.pushState(null,null,t+"/"+popup_userName+"/media")}else{window.History.pushState(null,null,t+"/")}}}}}}function navigateMedia(e){document.current_media_id=e;if(typeof shortcut!="undefined"){var t={type:"keydown",propagate:false,target:document};shortcut.remove("Right");shortcut.add("Right",nextMedia,t);shortcut.remove("Down");shortcut.add("Down",nextMedia,t);shortcut.remove("j");shortcut.add("j",nextMedia,t);shortcut.remove("J");shortcut.add("J",nextMedia,t);shortcut.remove("Left");shortcut.add("Left",prevMedia,t);shortcut.remove("Up");shortcut.add("Up",prevMedia,t);shortcut.remove("k");shortcut.add("k",prevMedia,t);shortcut.remove("K");shortcut.add("K",prevMedia,t)}}function stopNavigateMedia(){document.current_media_id=null;shortcut.remove("Right");shortcut.remove("Down");shortcut.remove("j");shortcut.remove("J");shortcut.remove("Left");shortcut.remove("Up");shortcut.remove("k");shortcut.remove("K")}function nextMedia(){var e=document.current_media_id;if(e){var t=getMediaDataFromLocalStorage(e);if(t&&t.date){var n=getMediaId(t.date,+1);openMediaModalPanel(n)}}}function prevMedia(){var e=document.current_media_id;if(e){var t=getMediaDataFromLocalStorage(e);if(t&&t.date){var n=getMediaId(t.date,-1);openMediaModalPanel(n)}}}function getMediaId(e,t){var n=null;if(e&&t){var r=jQuery(".main_event_box");var i=new Array;for(var s=0;s<r.length;s++){var o=r[s];if(o){var u=jQuery(o).attr("date");if(u){i[i.length]=u}}}i=sortDates(i);var a=mediaArrayindexOf(i,e);if(a>=0){a=a+t;a=a%i.length;if(a<0){a=i.length-1}var f=i[a];var l=jQuery(".main_event_box[date='"+f+"']");if(l&&l.length>0){var c=jQuery(l).find("img[mediaid]");if(c&&c.length>0){n=jQuery(c).attr("mediaid")}}}}return n}function sortDates(e){if(e){for(var t=0;t<e.length;t++){var n=e[t];var r=t;var i=null;for(var s=t;s<e.length;s++){i=e[s];if(n<i){e[r]=e[s];e[s]=n;r=s}}}return e}return null}function mediaArrayindexOf(e,t){if(e&&t){for(var n=0;n<e.length;n++){var r=e[n];if(r==t){return n}}}return-1}var meida_oldUrl=null;var meida_popup_userName=null;jQuery(document).ready(function(){meida_oldUrl=location.pathname+location.search+location.hash})
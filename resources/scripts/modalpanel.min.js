function searchUserFromLocal(e){if(local_quick_follwer_list&&local_quick_follwer_list.length>0){for(var t=0;t<local_quick_follwer_list.length;t++){usr=local_quick_follwer_list[t];if(usr.id==e){return true}}}return false}function getDataFromLocalStorage(e){return JSON.parse(localStorage.getItem("event_"+e))}function showBackGround(){var e=document.getElementById("div_follow_trans");jQuery(e).unbind("click");jQuery(e).bind("click",function(){closeModalPanel()});jQuery(e).fadeIn(200);document.body.style.overflow="hidden"}function setImageBackGroundLoader(e){jQuery(e).addClass("gdy_bg_loader");jQuery(e).css("background","url("+TIMETY_HOSTNAME+"images/loader.gif)");jQuery(e).css("background-repeat","no-repeat")}function setImageBackGroundCenter(e,t,n,r,i,s,o){if(e&&e.length){if(n<1&&t<1){n=30;t=30}try{setImageBackGroundLoader(e);jQuery(e).css("width",t+"px");jQuery(e).css("height",n+"px");var u=new Image;if(s.indexOf("http")==0){u.src=s}else{u.src=TIMETY_HOSTNAME+s}u.onload=function(){onloadImage(s,t,n,e,u,o)}}catch(a){console.log(a)}}}function onloadImage(e,t,n,r,i,s){var o="";var u=i.width;var a=i.height;if(u<1&&a<1){u=width;a=height}if(u>0&&a>0){if(u>a){if(u>t){a=t/u*a;u=t}}else{if(a>n){u=n/a*u;a=n}}jQuery(r).attr("height",a);if(s&&s>0){jQuery(r).css("width",s+"px")}else{jQuery(r).css("width",u+"px")}o=o+"&h="+a;o=o+"&w="+u;if(e.indexOf("http")!=0){e=TIMETY_SUBFOLDER+e}jQuery(r).css("background","url("+TIMETY_PAGE_GET_IMAGE_URL+e+o+")");jQuery(r).css("background-repeat","no-repeat")}}function setHeaderImage(e,t){if(e&&t&&t.url){var n=new Image;n.src=TIMETY_HOSTNAME+t.url;n.onload=function(){var r=false;var i="";var s=0;var o=0;s=n.width;o=n.height;if(s<1&&o<1){s=t.width;o=t.height}if(s>0&&o>0){if(s>561){o=561/s*o;s=561}jQuery(e).attr("src",TIMETY_HOSTNAME+t.url);r=true;setTimeout(function(){jQuery(e).attr("height",o);jQuery(e).attr("width",s)},10)}else{jQuery(e).css("max-width","560px")}if(!r){jQuery(e).attr("src",TIMETY_HOSTNAME+t.url)}}}}function openModalPanel(e,t){jQuery(".main_dropable_").css("display","none");var n=document.getElementById("foll_modal_creator");n.className="modal_follow_btn";jQuery(n).attr("disabled","disabled");var r=jQuery("#div_like_btn_modal_panel");setButtonStatus(r,false);r.show();var i=jQuery("#div_maybe_btn_modal_panel");setButtonStatus(i,false);i.show();var s=jQuery("#div_share_btn_modal_panel");setButtonStatus(s,false);s.show();var o=jQuery("#div_join_btn_modal_panel");setButtonStatus(o,false);o.show();var u=jQuery("#div_edit_btn_modal_panel");u.hide();var a=null;if(!t){a=getDataFromLocalStorage(e);try{a.images=JSON.parse(a.images)}catch(f){console.log(f)}if(!a){closeModalPanel();return}if(!addUrlEventId(e,a.title)){closeModalPanel();return false}}else{a=JSON.parse(t);e=a.id;if(!a){closeModalPanel();return}}showBackGround();var l=jQuery("#genel_detay_yeni");if(l){jQuery(l).unbind("click");jQuery(l).on("click",function(e){e.stopPropagation();e.preventDefault();return false});document.title="Timety | "+a.title;jQuery("#gdy_event_title").text(a.title);try{jQuery("#gdy_event_date").text(getLocalTime(a.startDateTime).format("YYYY-MM-DD HH:mm"))}catch(f){jQuery("#gdy_event_date").text(a.startDateTime)}jQuery("#gdy_event_description").text(a.description);jQuery("#name_creator").text("");setImageBackGroundLoader(jQuery("#image_creator"));jQuery("#about_creator").hide();if(a.creatorId){jQuery("#name_creator").text(a.creator.firstName+" "+a.creator.lastName);setImageBackGroundCenter(jQuery("#image_creator"),48,48,0,0,a.creator.userPicture);if(a.creator.about&&a.creator.about!="null"){jQuery("#about_creator").text(a.creator.about);jQuery("#about_creator").show()}else{jQuery("#about_creator").text("")}if(searchUserFromLocal(a.creatorId)>0){n.className=prefix+"followed_btn";n.setAttribute("onclick","unfollowUser("+userId+","+a.creatorId+',this,"modal_");')}else{jQuery.sessionphp.get("id",function(e){if(e){var t=document.getElementById("foll_modal_creator");t.className="modal_follow_btn";t.setAttribute("onclick","followUser("+e+","+a.creatorId+',this,"modal_");');jQuery(t).attr("disabled","disabled");var n="modal_";jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_CHECK_USER_FOLLOW_STATUS,data:{userId:e,fUserId:a.creatorId},error:function(e){jQuery(t).removeAttr("disabled")},success:function(r){jQuery(t).removeAttr("disabled");if(r==1||r=="1"){t.className=n+"followed_btn";t.setAttribute("onclick","unfollowUser("+e+","+a.creatorId+',this,"modal_");')}else{t.className=n+"follow_btn";t.setAttribute("onclick","followUser("+e+","+a.creatorId+',this,"modal_");')}}},"json")}})}}else{}var c=jQuery("#big_image_header");var h=true;try{var p=jQuery("img[eventid='"+a.id+"']");if(p&&p.length>0){var d=a.headerImage.org_width;var v=a.headerImage.org_height;if(d>0&&v>0){if(d>561){v=561/d*v;d=561}jQuery(c).attr("height",v);jQuery(c).attr("width",d);jQuery(c).attr("src",p.attr("src"));h=false}}}catch(f){console.log(f)}if(h){jQuery(c).attr("src",TIMETY_HOSTNAME+"images/loader.gif");jQuery(c).attr("height",30);jQuery(c).attr("width",30)}jQuery(c).attr("style","position:relative;margin-left:auto;margin-right:auto;");jQuery(c).css("min-height","30px");jQuery(c).css("min-width","30px");jQuery(c).css("margin-bottom","-3px");jQuery(c).css("cursor","pointer");jQuery(c).unbind("click");if(c&&a.headerImage&&a.headerImage.url){setHeaderImage(c,a.headerImage)}if(a.attach_link){jQuery(c).data("attach_link",a.attach_link);jQuery(c).click(function(){var e=jQuery(c).data("attach_link");if(e.indexOf("http")!=0){e="http://"+e}window.open(e,"_blank")})}jQuery("#fb_share_button").unbind("click");jQuery("#tw_share_button").unbind("click");jQuery("#gg_share_button").unbind("click");jQuery("#fb_share_button").click(shareThisFacebook);jQuery("#tw_share_button").click(function(){shareThisTwitter(a.title)});jQuery("#gg_share_button").click(shareThisGoogle);var m=false;var g=false;var y=0;if(a.userRelation){m=a.userRelation.like;g=a.userRelation.reshare;y=a.userRelation.joinType}if(m){setButtonStatus(r,true)}r.unbind("click");r.click(function(){likeEvent(this,a.id,jQuery("#likeshare_"+a.id+" #div_like_btn"));return false});if(y==2||y=="2"){setButtonStatus(i,true)}i.unbind("click");i.click(function(){sendResponseEvent(this,a.id,2);return false});if(y==1||y=="1"){setButtonStatus(o,true)}o.unbind("click");o.click(function(){sendResponseEvent(this,a.id,1);return false});if(g==1||g=="1"){setButtonStatus(s,true)}s.unbind("click");s.click(function(){reshareEvent(this,a.id,jQuery("#likeshare_"+a.id+" #div_share_btn"));return false});jQuery.sessionphp.get("id",function(e){if(e+""==a.creatorId+""){s.hide();o.hide();i.hide();r.hide();u.show();u.unbind("click");u.click(function(){openEditEvent(a.id);return false})}});jQuery("#gdy_users_div").children().remove();getUsers(jQuery("#gdy_users_div"),e);getComments(e);jQuery(l).fadeIn(400)}else{closeModalPanel()}}function getComments(e){sending=false;jQuery("[id*='tmp_comment_template_']").remove();jQuery.sessionphp.get("id",function(t){var n=t;if(n!=null&&n>0){jQuery("#write_comment").show();jQuery("#sendComment").attr("eventid",e)}});jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETCOMMENTS,data:{eventId:e,lastComment:"*",count:"3"},success:function(e){e=JSON.parse(e);if(!e.error&&e.array){var t=e.array;for(var n=0;n<t.length;n++){var r=t[n];lastCommentId=r.id;var i=jQuery("#comment_template").clone();jQuery(i).attr("id","tmp_comment_template_"+r.id);jQuery(i).insertBefore(jQuery("#tumyorumlar"));var s=jQuery(i).find("#comment_user_img");var o=jQuery(i).find("#comment_user");var u=jQuery(i).find("#comment_text");setImageBackGroundCenter(s,32,31,0,0,r.userPic,56);jQuery(o).text(r.userName);jQuery(u).text(r.comment);jQuery(i).show()}if(e.count){var a=jQuery("#tumyorumlar");jQuery(a).show();var f=jQuery("#tumyorumlar #tumyorumlar_text");jQuery(f).unbind("click");jQuery(f).attr("onclick","return openNextComments(5);");var l=5;if(e.count<5){l=e.count}jQuery(f).text("See "+l+" Next comments ("+e.count+")...")}}}})}function getUsers(e,t,n){jQuery("#gdy_users_count").text(1);jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETEVENTATTENDANCES,data:{eventId:t},success:function(t){t=JSON.parse(t);if(!t.error){jQuery("#gdy_users_count").text(t.length);for(var n=0;n<t.length;n++){var r=jQuery("#users_"+t[n].id);if(t[n].pic&&!r.length){var i=document.createElement("div");jQuery(i).addClass("gdy_alt_rsm");jQuery(i).attr("id","users_"+t[n].id);jQuery(i).attr("title",t[n].fullName);jQuery(i).data("img",t[n]);jQuery(e).append(i);setImageBackGroundCenter(jQuery("#users_"+t[n].id),64,52,0,0,t[n].pic)}}}}})}function getImages(e,t){jQuery("#gdy_images_count").text(1);jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETEVENTIMAGES,data:{eventId:t},success:function(t){t=JSON.parse(t);if(!t.error){jQuery("#gdy_images_count").text(t.length);for(var n=0;n<t.length;n++){var r=jQuery("#images_"+t[n].id);if(t[n].url&&!r.length){var i=document.createElement("div");jQuery(i).addClass("gdy_alt_rsm");jQuery(i).attr("id","images_"+t[n].id);jQuery(i).data("img",t[n]);jQuery(e).append(i);setImageBackGroundCenter(jQuery("#images_"+t[n].id),64,51,0,0,t[n].url);jQuery(i).click(function(){setHeaderImage(jQuery("#big_image_header"),jQuery(this).data("img"))})}}}}})}function closeModalPanel(){try{remUrlEventId();document.title="Timety | Never miss out";var e=document.getElementById("div_follow_trans");jQuery(e).unbind("click");jQuery(e).bind("click",function(){return false});jQuery(e).fadeOut(500,function(){document.body.style.overflowY="scroll"});jQuery("#genel_detay_yeni").fadeOut(450)}catch(t){console.log(t)}return false}function addUrlEventId(e,t){if(history.pushState){var n=window.location.href.split("/");if(n){if(jQuery.inArray("event",n)<0){if(t){t=t.replace(/ /g,"-");t=t.replace(/[^A-Za-z0-9-]+/g,"")}window.History.pushState(null,null,"event/"+e+"/"+t);_gaq.push(["_setAccount",TIMETY_GOOGLE_ANALYTICS]);_gaq.push(["_trackPageview",location.pathname+location.search+location.hash]);if(pSUPERFLY)pSUPERFLY.virtualPage("/event/"+e+"/"+t,t+"")}else{path="";for(var r=jQuery.inArray(window.location.hostname,n)+1;r<n.length&&n[r]!="event";r++){path=path+"/"+n[r]}window.History.pushState(null,null,path+"/"+"event/"+e);_gaq.push(["_setAccount",TIMETY_GOOGLE_ANALYTICS]);_gaq.push(["_trackPageview",location.pathname+location.search+location.hash]);if(pSUPERFLY)pSUPERFLY.virtualPage("/event/"+e,e+"")}}}else{getLoader(true);window.location=TIMETY_PAGE_EVENT_DETAIL+e;return false}return true}function remUrlEventId(){if(history.pushState){if(oldUrl){window.History.pushState(null,null,oldUrl)}else{var e=window.location.href.split("/");if(e){if(jQuery.inArray("event",e)>=0){var t="";for(var n=jQuery.inArray(window.location.hostname,e)+1;n<e.length&&e[n]!="event";n++){t=t+"/"+e[n]}window.History.pushState(null,null,t+"/")}}}}}function openNextComments(e){var t=jQuery("#sendComment").attr("eventId");jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETCOMMENTS,data:{eventId:t,lastComment:lastCommentId,count:e},success:function(e){e=JSON.parse(e);if(!e.error&&e.array){lastCommentId=e.array[e.array.length-1].id;for(var t=e.array.length-1;t>=0;t--){var n=e.array[t];lastCommentId=n.id;var r=jQuery("#comment_template").clone();jQuery(r).attr("id","tmp_comment_template_"+n.id);jQuery(r).insertBefore(jQuery("#tumyorumlar"));var i=jQuery(r).find("#comment_user_img");var s=jQuery(r).find("#comment_user");var o=jQuery(r).find("#comment_text");setImageBackGroundCenter(i,32,31,0,0,n.userPic,56);jQuery(s).text(n.userName);jQuery(o).text(n.comment);jQuery(r).show()}}var u=jQuery("#tumyorumlar");if(e.count){jQuery(u).show();var a=jQuery("#tumyorumlar #tumyorumlar_text");jQuery(a).unbind("click");jQuery(a).attr("onclick","return openNextComments(5);");var f=5;if(e.count<5){f=e.count}jQuery(a).text("See "+f+" Next comments ("+e.count+")...")}else{jQuery(u).hide()}}})}function sendComment(){if(!sending){jQuery.sessionphp.get("id",function(e){var t=e;var n=jQuery("#sendComment").val();var r=jQuery("#sendComment").attr("eventId");if(n&&n.length>1&&n!=jQuery("#sendComment").attr("placeholder")&&r&&t){sending=true;jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_ADDCOMMENTS,data:{eventId:r,userId:t,comment:n},success:function(e){sending=false;e=JSON.parse(e);if(!e.error){var t=jQuery("#comment_template").clone();jQuery(t).attr("id","tmp_comment_template_"+e.id);jQuery(t).insertAfter(jQuery("#comment_template"));var n=jQuery(t).find("#comment_user_img");var r=jQuery(t).find("#comment_user");var i=jQuery(t).find("#comment_text");setImageBackGroundCenter(n,32,31,0,0,e.userPic,56);jQuery(r).text(e.userName);jQuery(i).text(e.comment);jQuery(t).show();jQuery("#sendComment").val("")}}})}})}}var lastCommentId=-1;var sending=false;var oldUrl=null;jQuery(document).ready(function(){oldUrl=window.location.href;jQuery("#sendComment").keyup(function(e){if(e.keyCode==13){sendComment()}})})
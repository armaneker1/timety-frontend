function searchUserFromLocal(e){if(local_quick_follwer_list&&local_quick_follwer_list.length>0){for(var t=0;t<local_quick_follwer_list.length;t++){usr=local_quick_follwer_list[t];if(usr.id==e){return true}}}return false}function getDataFromLocalStorage(e){return JSON.parse(localStorage.getItem("event_"+e))}function showBackGround(){var e=document.getElementById("div_follow_trans");jQuery(e).unbind("click");jQuery(e).bind("click",function(){closeModalPanel()});jQuery(e).fadeIn(200);document.body.style.overflow="hidden"}function setImageBackGroundLoader(e){jQuery(e).addClass("gdy_bg_loader");jQuery(e).css("background","url("+TIMETY_HOSTNAME+"images/loader.gif)");jQuery(e).css("background-repeat","no-repeat")}function setImageBackGroundCenter(e,t,n,r,i,s,o){if(e&&e.length){if(n<1&&t<1){n=30;t=30}try{setImageBackGroundLoader(e);jQuery(e).css("width",t+"px");jQuery(e).css("height",n+"px");var u=new Image;if(s.indexOf("http")==0){u.src=s}else{u.src=TIMETY_HOSTNAME+s}u.onload=function(){onloadImage(s,t,n,e,u,o)}}catch(a){console.log(a)}}}function onloadImage(e,t,n,r,i,s){var o="";var u=i.width;var a=i.height;if(u<1&&a<1){u=width;a=height}if(u>0&&a>0){if(u>a){if(u>t){a=t/u*a;u=t}}else{if(a>n){u=n/a*u;a=n}}jQuery(r).attr("height",a);if(s&&s>0){jQuery(r).css("width",s+"px")}else{jQuery(r).css("width",u+"px")}o=o+"&h="+a;o=o+"&w="+u;if(e.indexOf("http")!=0){e=TIMETY_SUBFOLDER+e}jQuery(r).css("background","url("+TIMETY_PAGE_GET_IMAGE_URL+e+o+")");jQuery(r).css("background-repeat","no-repeat")}}function setHeaderImage(e,t){if(e&&t&&t.url){var n=new Image;n.src=TIMETY_HOSTNAME+t.url;n.onload=function(){var r=false;var i="";var s=0;var o=0;s=n.width;o=n.height;if(s<1&&o<1){s=t.width;o=t.height}if(s>0&&o>0){if(s>561){o=561/s*o;s=561}jQuery(e).attr("src",TIMETY_HOSTNAME+t.url);r=true;setTimeout(function(){jQuery(e).attr("height",o);jQuery(e).attr("width",s)},10)}else{jQuery(e).css("max-width","560px")}if(!r){jQuery(e).attr("src",TIMETY_HOSTNAME+t.url)}}}}function openModalPanel(e,t){jQuery(".main_dropable_").css("display","none");var n=document.getElementById("foll_modal_creator");n.className="modal_follow_btn";n.innerHTML="follow";jQuery(n).attr("disabled","disabled");var r=null;if(!t){r=getDataFromLocalStorage(e);try{r.images=JSON.parse(r.images)}catch(i){console.log(i)}if(!r){closeModalPanel();return}if(!addUrlEventId(e,r.title)){closeModalPanel();return false}}else{r=JSON.parse(t);e=r.id;if(!r){closeModalPanel();return}}showBackGround();var s=jQuery("#genel_detay_yeni");if(s){jQuery(s).unbind("click");jQuery(s).on("click",function(e){e.stopPropagation();e.preventDefault();return false});document.title="Timety | "+r.title;jQuery("#gdy_event_title").text(r.title);try{jQuery("#gdy_event_date").text(getLocalTime(r.startDateTime).format("YYYY-MM-DD HH:mm"))}catch(i){jQuery("#gdy_event_date").text(r.startDateTime)}jQuery("#gdy_event_description").text(r.description);jQuery("#name_creator").text("");setImageBackGroundLoader(jQuery("#image_creator"));jQuery("#about_creator").hide();if(r.creatorId){jQuery("#name_creator").text(r.creator.firstName+" "+r.creator.lastName);setImageBackGroundCenter(jQuery("#image_creator"),48,48,0,0,r.creator.userPicture);if(r.creator.about&&r.creator.about!="null"){jQuery("#about_creator").text(r.creator.about);jQuery("#about_creator").show()}else{jQuery("#about_creator").text("")}if(searchUserFromLocal(r.creatorId)>0){n.className=prefix+"followed_btn";n.innerHTML="unfollow";n.setAttribute("onclick","unfollowUser("+userId+","+r.creatorId+',this,"modal_");')}else{jQuery.sessionphp.get("id",function(e){if(e){var t=document.getElementById("foll_modal_creator");t.className="modal_follow_btn";t.innerHTML="follow";t.setAttribute("onclick","followUser("+e+","+r.creatorId+',this,"modal_");');jQuery(t).attr("disabled","disabled");var n="modal_";jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_CHECK_USER_FOLLOW_STATUS,data:{userId:e,fUserId:r.creatorId},error:function(e){jQuery(t).removeAttr("disabled")},success:function(i){jQuery(t).removeAttr("disabled");if(i==1||i=="1"){t.className=n+"followed_btn";t.innerHTML="unfollow";t.setAttribute("onclick","unfollowUser("+e+","+r.creatorId+',this,"modal_");')}else{t.className=n+"follow_btn";t.innerHTML="follow";t.setAttribute("onclick","followUser("+e+","+r.creatorId+',this,"modal_");')}}},"json")}})}}else{}var o=jQuery("#big_image_header");jQuery(o).attr("src",TIMETY_HOSTNAME+"images/loader.gif");jQuery(o).attr("style","position:relative;margin-left:auto;margin-right:auto;");jQuery(o).css("min-height","30px");jQuery(o).css("min-width","30px");jQuery(o).css("margin-bottom","-3px");jQuery(o).attr("height",30);jQuery(o).attr("width",30);jQuery(o).css("cursor","pointer");jQuery(o).unbind("click");if(r.attach_link){jQuery(o).data("attach_link",r.attach_link);jQuery(o).click(function(){var e=jQuery(o).data("attach_link");if(e.indexOf("http")!=0){e="http://"+e}window.open(e,"_blank")})}if(o&&r.headerImage&&r.headerImage.url){setHeaderImage(o,r.headerImage)}jQuery("#fb_share_button").unbind("click");jQuery("#tw_share_button").unbind("click");jQuery("#gg_share_button").unbind("click");jQuery("#fb_share_button").click(shareThisFacebook);jQuery("#tw_share_button").click(function(){shareThisTwitter(r.title)});jQuery("#gg_share_button").click(shareThisGoogle);var u=false;var a=false;var f=0;if(r.userRelation){u=r.userRelation.like;a=r.userRelation.reshare;f=r.userRelation.joinType}if(u){}else{}var l=jQuery("#button_maybe");var c=jQuery("#button_join");jQuery(l).unbind("click");jQuery(l).attr("class_aktif","tmp_aktif");jQuery(l).attr("class_pass","tmp_pass");jQuery(l).click(function(){sendResponseEvent(this,r.id,2);return false});if(f==2||f=="2"){setButtonStatus(l,true)}else{setButtonStatus(l,false)}jQuery(c).unbind("click");jQuery(c).attr("class_aktif","tmp_aktif");jQuery(c).attr("class_pass","tmp_pass");jQuery(c).click(function(){sendResponseEvent(this,r.id,1);return false});if(f==1||f=="1"){setButtonStatus(c,true)}else{setButtonStatus(c,false)}var h=jQuery("#button_reshare");jQuery(h).unbind("click");jQuery(h).attr("class_aktif","tmp_aktif");jQuery(h).attr("class_pass","tmp_pass");jQuery(h).click(function(){reshareEvent(this,r.id);return false});if(a){setButtonStatus(h,true)}else{setButtonStatus(h,false)}jQuery("#gdy_users_div").children().remove();getUsers(jQuery("#gdy_users_div"),e);getComments(e);jQuery(s).fadeIn(400)}else{closeModalPanel()}}function getComments(e){sending=false;jQuery("[id*='tmp_comment_template_']").remove();jQuery.sessionphp.get("id",function(t){var n=t;if(n!=null&&n>0){jQuery("#write_comment").show();jQuery("#sendComment").attr("eventid",e)}});jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETCOMMENTS,data:{eventId:e,lastComment:"*",count:"3"},success:function(e){e=JSON.parse(e);if(!e.error&&e.array){var t=e.array;for(var n=0;n<t.length;n++){var r=t[n];lastCommentId=r.id;var i=jQuery("#comment_template").clone();jQuery(i).attr("id","tmp_comment_template_"+r.id);jQuery(i).insertBefore(jQuery("#tumyorumlar"));var s=jQuery(i).find("#comment_user_img");var o=jQuery(i).find("#comment_user");var u=jQuery(i).find("#comment_text");setImageBackGroundCenter(s,32,31,0,0,r.userPic,56);jQuery(o).text(r.userName);jQuery(u).text(r.comment);jQuery(i).show()}if(e.count){var a=jQuery("#tumyorumlar");jQuery(a).show();var f=jQuery("#tumyorumlar #tumyorumlar_text");jQuery(f).unbind("click");jQuery(f).attr("onclick","return openNextComments(5);");var l=5;if(e.count<5){l=e.count}jQuery(f).text("See "+l+" Next comments ("+e.count+")...")}}}})}function getUsers(e,t,n){jQuery("#gdy_users_count").text(1);jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETEVENTATTENDANCES,data:{eventId:t},success:function(t){t=JSON.parse(t);if(!t.error){jQuery("#gdy_users_count").text(t.length);for(var n=0;n<t.length;n++){var r=jQuery("#users_"+t[n].id);if(t[n].pic&&!r.length){var i=document.createElement("div");jQuery(i).addClass("gdy_alt_rsm");jQuery(i).attr("id","users_"+t[n].id);jQuery(i).attr("title",t[n].fullName);jQuery(i).data("img",t[n]);jQuery(e).append(i);setImageBackGroundCenter(jQuery("#users_"+t[n].id),64,52,0,0,t[n].pic)}}}}})}function getImages(e,t){jQuery("#gdy_images_count").text(1);jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETEVENTIMAGES,data:{eventId:t},success:function(t){t=JSON.parse(t);if(!t.error){jQuery("#gdy_images_count").text(t.length);for(var n=0;n<t.length;n++){var r=jQuery("#images_"+t[n].id);if(t[n].url&&!r.length){var i=document.createElement("div");jQuery(i).addClass("gdy_alt_rsm");jQuery(i).attr("id","images_"+t[n].id);jQuery(i).data("img",t[n]);jQuery(e).append(i);setImageBackGroundCenter(jQuery("#images_"+t[n].id),64,51,0,0,t[n].url);jQuery(i).click(function(){setHeaderImage(jQuery("#big_image_header"),jQuery(this).data("img"))})}}}}})}function closeModalPanel(){try{remUrlEventId();document.title="Timety | Never miss out";var e=document.getElementById("div_follow_trans");jQuery(e).unbind("click");jQuery(e).bind("click",function(){return false});jQuery(e).fadeOut(500,function(){document.body.style.overflowY="scroll"});jQuery("#genel_detay_yeni").fadeOut(450)}catch(t){console.log(t)}return false}function addUrlEventId(e,t){if(history.pushState){var n=window.location.href.split("/");if(n){if(jQuery.inArray("event",n)<0){if(t){t=t.replace(/ /g,"-");t=t.replace(/[^A-Za-z0-9-]+/g,"")}window.History.pushState(null,null,"event/"+e+"/"+t);_gaq.push(["_setAccount",TIMETY_GOOGLE_ANALYTICS]);_gaq.push(["_trackPageview",location.pathname+location.search+location.hash]);if(pSUPERFLY)pSUPERFLY.virtualPage("/event/"+e+"/"+t,t+"")}else{path="";for(var r=jQuery.inArray(window.location.hostname,n)+1;r<n.length&&n[r]!="event";r++){path=path+"/"+n[r]}window.History.pushState(null,null,path+"/"+"event/"+e);_gaq.push(["_setAccount",TIMETY_GOOGLE_ANALYTICS]);_gaq.push(["_trackPageview",location.pathname+location.search+location.hash]);if(pSUPERFLY)pSUPERFLY.virtualPage("/event/"+e,e+"")}}}else{getLoader(true);window.location=TIMETY_PAGE_EVENT_DETAIL+e;return false}return true}function remUrlEventId(){if(history.pushState){if(oldUrl){window.History.pushState(null,null,oldUrl)}else{var e=window.location.href.split("/");if(e){if(jQuery.inArray("event",e)>=0){var t="";for(var n=jQuery.inArray(window.location.hostname,e)+1;n<e.length&&e[n]!="event";n++){t=t+"/"+e[n]}window.History.pushState(null,null,t+"/")}}}}}function openNextComments(e){var t=jQuery("#sendComment").attr("eventId");jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETCOMMENTS,data:{eventId:t,lastComment:lastCommentId,count:e},success:function(e){e=JSON.parse(e);if(!e.error&&e.array){lastCommentId=e.array[e.array.length-1].id;for(var t=e.array.length-1;t>=0;t--){var n=e.array[t];lastCommentId=n.id;var r=jQuery("#comment_template").clone();jQuery(r).attr("id","tmp_comment_template_"+n.id);jQuery(r).insertBefore(jQuery("#tumyorumlar"));var i=jQuery(r).find("#comment_user_img");var s=jQuery(r).find("#comment_user");var o=jQuery(r).find("#comment_text");setImageBackGroundCenter(i,32,31,0,0,n.userPic,56);jQuery(s).text(n.userName);jQuery(o).text(n.comment);jQuery(r).show()}}var u=jQuery("#tumyorumlar");if(e.count){jQuery(u).show();var a=jQuery("#tumyorumlar #tumyorumlar_text");jQuery(a).unbind("click");jQuery(a).attr("onclick","return openNextComments(5);");var f=5;if(e.count<5){f=e.count}jQuery(a).text("See "+f+" Next comments ("+e.count+")...")}else{jQuery(u).hide()}}})}function sendComment(){if(!sending){jQuery.sessionphp.get("id",function(e){var t=e;var n=jQuery("#sendComment").val();var r=jQuery("#sendComment").attr("eventId");if(n&&n.length>1&&r&&t){sending=true;jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_ADDCOMMENTS,data:{eventId:r,userId:t,comment:n},success:function(e){sending=false;e=JSON.parse(e);if(!e.error){var t=jQuery("#comment_template").clone();jQuery(t).attr("id","tmp_comment_template_"+e.id);jQuery(t).insertAfter(jQuery("#comment_template"));var n=jQuery(t).find("#comment_user_img");var r=jQuery(t).find("#comment_user");var i=jQuery(t).find("#comment_text");setImageBackGroundCenter(n,32,31,0,0,e.userPic,56);jQuery(r).text(e.userName);jQuery(i).text(e.comment);jQuery(t).show();jQuery("#sendComment").val("")}}})}})}}var lastCommentId=-1;var sending=false;var oldUrl=null;jQuery(document).ready(function(){oldUrl=window.location.href;jQuery("#sendComment").keyup(function(e){if(e.keyCode==13){sendComment()}})})
function initPageButtons(){jQuery.sessionphp.get("id",function(e){if(e){var t=jQuery(".main_event_box .joinLikeBtn");if(t&&t.length>0){for(var n=0;n<t.length;n++){var r=t[n];if(r){checkEventRelation(e,r)}}}}})}function checkEventRelation(e,t){if(typeof t!="undefined"&&e){var n=jQuery(t).find("div[btntype='join']");var r=jQuery(t).find("div[btntype='maybe']");var i=jQuery(t).find("div[class_pass='likeEvent']");var s=jQuery(t).find("div[class_pass='reshareEvent']");var o=jQuery(n).attr("eventid");var u=jQuery(n).data("checked");if(o&&u!="true"){var a=getLocalEventData(e,o);if(a&&a.userRelation){a=a.userRelation;if(a.like){setButtonStatus(i,true)}if(a.reshare){setButtonStatus(s,true)}if(a.joinType==1){setButtonStatus(n,true);setButtonStatus(r,false);jQuery(r).hide()}if(a.joinType==2){setButtonStatus(n,false);setButtonStatus(r,true);jQuery(n).hide()}jQuery(n).data("checked","true")}}}}function getUserLocalDateKey(e){return"c_user_event_"+e}function checkLocalData(){jQuery.sessionphp.get("id",function(e){if(e){var t=getUserLocalDateKey(e);var n=localStorage.getItem(t);if(n){n=Base64.decode(n)}var r=moment().format("YYYYMMDD");if(r!=n){localStorage.setItem(t,Base64.encode(r));getUserEvents(e)}}checkOutOfDateEvents(e)})}function checkOutOfDateEvents(e){if(e){var t=moment().add("days","-7").format("YYYYMMDD");for(var n in localStorage){if(n&&n.indexOf("c_event_")==0){var r=localStorage.getItem(n);if(r){r=Base64.decode(r);r=JSON.parse(r);var i=r.date;if(i<t){localStorage.removeItem(n)}}else{localStorage.removeItem(n)}}}}}function getUserEvents(e){if(typeof e=="undefined"||e==null||e==""){return false}jQuery.ajax({type:"GET",url:TIMETY_PAGE_AJAX_GET_USER_EVENTS,dataType:"json",contentType:"application/json",data:{userId:e},success:function(t){try{if(typeof t=="string"){t=jQuery.parseJSON(t)}}catch(n){console.log(n);console.log(t)}var r="c_event_"+e;for(var i in localStorage){if(i&&i.indexOf(r)==0){localStorage.removeItem(i)}}if(t&&t.success){var s=t.param;if(s){for(var o in s){if(o&&o>0){var u=s[o];setEventLocal(e,o,u)}}}}else{console.log(t)}}},"json");return true}function getEventLocalKey(e,t){return"c_event_"+e+"_"+t}function setEventLocal(e,t,n){if(e&&t&&n){var r=new Object;r.eventId=t;r.userRelation=n;r.date=moment().format("YYYYMMDD");r=JSONstring.make(r);r=Base64.encode(r);var i=getEventLocalKey(e,t);localStorage.setItem(i,r)}}function updateLocalEvent(e,t,n,r){if(e&&t&&n){var i=getLocalEventData(e,t);if(i&&i.eventId){if(i.userRelation){i.userRelation[n]=r;setEventLocal(e,t,i.userRelation)}else{var s=new Object;s[n]=r;setEventLocal(e,t,s)}}else{s=new Object;s[n]=r;setEventLocal(e,t,s)}}}function getLocalEventData(e,t,n,r){if(typeof r=="undefined")r=false;if(typeof n=="undefined")n=null;if(e&&t){var i=getEventLocalKey(e,t);var s=localStorage.getItem(i);if(s){s=Base64.decode(s);s=JSON.parse(s);if(n&&jQuery.isFunction(n)){n.call(this,s);return null}else{return s}}else if(n&&jQuery.isFunction(n)&&r){jQuery.ajax({type:"GET",url:TIMETY_PAGE_AJAX_GET_EVENT_USER_RELATION,dataType:"json",contentType:"application/json",data:{userId:e,eventId:t},success:function(r){try{if(typeof r=="string"){r=jQuery.parseJSON(r)}}catch(i){console.log(i);console.log(data)}if(r){var s=new Object;s.eventId=t;s.userRelation=r;setEventLocal(e,t,r);n.call(this,s);return}}},"json")}}return null}jQuery(document).ready(function(){checkLocalData();initPageButtons()})
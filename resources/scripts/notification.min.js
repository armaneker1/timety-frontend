function closeOtherNotf(){jQuery("#populer_top_menu").stop();jQuery("#populer_top_menu").hide();jQuery("#following_top_menu").stop();jQuery("#following_top_menu").hide()}function checkNotifications(e){if(post_notifications_count){post_notifications_count.abort()}post_notifications_count=jQuery.ajax({type:"GET",url:TIMETY_PAGE_AJAX_GETNOTFCOUNT,data:{userId:e},success:function(e){if(e>0){var t=jQuery("#avtr_box_not");if(!t.length){t=jQuery('<div id="avtr_box_not" class="avtr_box">'+e+"</div>");var n=jQuery("#te_avatar");n.append(t)}else{t.text(e)}}else{t=jQuery("#avtr_box_not");t.remove()}}},"json");setTimeout(checkNotifications,5e3,e)}function closeNotifications(e){if(e&&e.target&&!(e.target.id+""=="te_avatar"||jQuery(e.target).parents().is("#te_avatar")||e.target.id+""=="my_timety_notf_container"||jQuery(e.target).parents().is("#my_timety_notf_container"))){jQuery("body").unbind("click.notfs");jQuery("#my_timety_notf_container").hide();var t=jQuery("#my_timety_notf ul li[notf_id]");jQuery(".new_not").remove();if(t.length>0){var n=null;for(var r=0;r<t.length;r++){var i=jQuery(t[r]).attr("notf_id");if(i){if(n){n=n+","+i}else{n=i}}}if(n){jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_MARK_NOTF_READ,data:{notfIds:n},success:function(e){console.log("OK");jQuery.sessionphp.get("id",function(e){if(e){checkNotifications(e)}})}},"json")}}}return true}function showNotifications(e){jQuery("body").bind("click.notfs",closeNotifications);var t=jQuery("#my_timety_notf_container");var n=jQuery("#my_timety_notf ul");t.show();var r=jQuery("#notf_loader_img");if(post_notifications){post_notifications.abort()}post_notifications=jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETNOTF,data:{userId:e,limit:10},success:function(e){var t=jQuery.parseJSON(e);r.hide();if(t&&!t.error&&t.length>0){for(var i=t.length-1;i>=0;i--){var s=t[i];var o=jQuery(s);var u=jQuery("#"+jQuery(o).attr("id"));if(u.length<1){jQuery(o).insertAfter("#notf_loader_img")}}}jQuery("#li_notf_no_new_notf").remove();if(n.children().length<2){o=jQuery("<li>");o.attr("id","li_notf_no_new_notf");title="No new notification";o.append('<a style="color:#C2C2C2;float:left;" href="#" onclick="return false;">'+title+"</a>");o.append("<span>    </span>");n.append(o)}}},"json")}function responseEvent(e,t,n,r){if(t&&n&&r){var i=jQuery("#li_notf_"+e);if(i.length){jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_JOINEVENT,data:{eventId:n,userId:t,type:r},success:function(t){if(typeof t=="string"){t=jQuery.parseJSON(t)}else{t=t}jQuery("#li_notf_"+e+" .notf_answer_class").remove();if(t.success){var n="";if(r==1){n="Joined"}else if(r==2){n="Maybe"}else if(r==3){n="Ignored"}jQuery("#li_notf_"+e+" div").append(jQuery("<span style='font-weight: normal;color:#C2C2C2;float:left;'> ("+n+") </span>"))}}},"json")}}return false}var post_notifications=null;var post_notifications_count=null;var notf_click_check;jQuery(document).ready(function(){jQuery("#te_avatar").click(function(e){jQuery.sessionphp.get("id",function(e){if(e){closeOtherNotf();showNotifications(e)}})});jQuery.sessionphp.get("id",function(e){if(e){setTimeout(checkNotifications,1e4,e)}})})
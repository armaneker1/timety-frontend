function closeOtherNotf(){jQuery("#populer_top_menu").stop();jQuery("#populer_top_menu").hide();jQuery("#following_top_menu").stop();jQuery("#following_top_menu").hide()}function checkNotifications(e){if(post_notifications_count){post_notifications_count.abort()}post_notifications_count=jQuery.ajax({type:"GET",url:TIMETY_PAGE_AJAX_GETNOTFCOUNT,data:{userId:e},success:function(t){if(t>0){var n=jQuery("#avtr_box_not");if(!n.length){n=jQuery('<div id="avtr_box_not" class="avtr_box">'+t+"</div>");notfDiv=jQuery("#top_notification_button");notfDiv.append(n)}else{n.text(t)}}else{n=jQuery("#avtr_box_not");n.remove()}setTimeout(checkNotifications,TIMETY_NOTIFICATION_CHECK_TIME,e)},error:function(){setTimeout(checkNotifications,TIMETY_NOTIFICATION_CHECK_TIME,e)}},"json")}function closeNotifications(e){if(!e||e&&e.target&&!(e.target.id+""=="top_notification_button"||jQuery(e.target).parents().is("#top_notification_button")||e.target.id+""=="my_timety_notf_container"||jQuery(e.target).parents().is("#my_timety_notf_container"))){jQuery("body").unbind("click.notfs");jQuery("#my_timety_notf_container").hide();var t=jQuery("#my_timety_notf ul li[notf_id]");jQuery(".new_not").remove();if(t.length>0){var n=null;for(var r=0;r<t.length;r++){var i=jQuery(t[r]).attr("notf_id");if(i){if(n){n=n+","+i}else{n=i}}}if(n){jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_MARK_NOTF_READ,data:{notfIds:n},success:function(e){console.log("OK");jQuery.sessionphp.get("id",function(e){if(e){checkNotifications(e)}})}},"json")}}jQuery("#my_timety_notf").unbind("mouseleave");jQuery(".layout_top_menu_user").unbind("mouseenter");jQuery("#top_addeventButton").unbind("mouseenter");jQuery(".layout_top_menu_categories").unbind("mouseenter");jQuery(".layout_top_menu_time").unbind("mouseenter");jQuery(".layout_top_menu_foryou").unbind("mouseenter")}return true}function showNotifications(e){jQuery(".layout_top_menu_user").mouseenter(function(){closeNotifications(null)});jQuery("#top_addeventButton").mouseenter(function(){closeNotifications(null)});jQuery(".layout_top_menu_categories").mouseenter(function(){closeNotifications(null)});jQuery(".layout_top_menu_time").mouseenter(function(){closeNotifications(null)});jQuery(".layout_top_menu_foryou").mouseenter(function(){closeNotifications(null)});jQuery("body").bind("click.notfs",closeNotifications);var t=jQuery("#my_timety_notf_container");var n=jQuery("#my_timety_notf ul");t.show();if(post_notifications){post_notifications.abort()}post_notifications=jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_GETNOTF,data:{userId:e,limit:10},success:function(e){var t=jQuery.parseJSON(e);if(t&&!t.error&&t.length>0){for(var r=t.length-1;r>=0;r--){var i=t[r];var s=jQuery(i);var o=jQuery("#"+jQuery(s).attr("id"));if(o.length<1){jQuery(s).insertAfter("#notf_loader_img")}}}jQuery("#li_notf_no_new_notf").remove();if(n.children().length<2){s=jQuery("<li>");s.attr("id","li_notf_no_new_notf");var u=getLanguageText("LANG_NOTIFICATION_NO_NEW_NOTF");s.append('<a style="color:#C2C2C2;float:left;" href="#" onclick="return false;">'+u+"</a>");s.append("<span>    </span>");n.append(s)}}},"json")}function responseEvent(e,t,n,r){if(t&&n&&r){var i=jQuery("#li_notf_"+e);if(i.length){jQuery.ajax({type:"POST",url:TIMETY_PAGE_AJAX_JOINEVENT,data:{eventId:n,userId:t,type:r},success:function(t){if(typeof t=="string"){t=jQuery.parseJSON(t)}else{t=t}jQuery("#li_notf_"+e+" .notf_answer_class").remove();if(t.success){var n="";if(r==1){n="Joined"}else if(r==2){n="Maybe"}else if(r==3){n="Ignored"}jQuery("#li_notf_"+e+" div").append(jQuery("<span style='font-weight: normal;color:#C2C2C2;float:left;'> ("+n+") </span>"))}}},"json")}}return false}var post_notifications=null;var post_notifications_count=null;var notf_click_check;jQuery(document).ready(function(){jQuery("#top_notification_button").click(function(e){jQuery.sessionphp.get("id",function(e){if(e){closeOtherNotf();showNotifications(e)}})});jQuery("#my_timety_notf").mouseenter(function(){jQuery("#my_timety_notf").unbind("mouseleave");jQuery("#my_timety_notf").mouseleave(function(){closeNotifications(null)})});jQuery.sessionphp.get("id",function(e){if(e){setTimeout(checkNotifications,TIMETY_NOTIFICATION_CHECK_TIME,e)}})})